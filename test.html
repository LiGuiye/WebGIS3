<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
		<title>Synchronize MapView and SceneView - 4.10</title>

		<style>

		</style>

		<link rel="stylesheet" href="https://js.arcgis.com/4.10/esri/css/main.css">
		<script src="https://js.arcgis.com/4.10/"></script>

		<script>
			require([
				"esri/Map",
				"esri/views/MapView",
				"esri/views/SceneView",
				"esri/core/watchUtils"
			], function(
				Map,
				MapView, SceneView,
				watchUtils
			) {

				var map1 = new Map({
					basemap: 'osm'
				});
				var map2 = new Map({
					basemap: 'streets'
				});

				var view1 = new MapView({
					id: 'view1',
					container: 'view1Div',
					map: map1,
					zoom: 4,
					center: [15, 65] // longitude, latitude
				});

				var view2 = new MapView({
					id: 'view2',
					container: 'view2Div',
					map: map2,
					zoom: 4,
					center: [15, 65], // longitude, latitude
					constraints: {
						// Disable zoom snapping to get the best synchonization
						snapToZoom: false
					}
				});

				/**
				 * utility method that synchronizes the viewpoint of a view to other views
				 */
				var synchronizeView = function(view, others) {
					others = Array.isArray(others) ? others : [others];

					var viewpointWatchHandle;
					var viewStationaryHandle;
					var otherInteractHandlers;
					var scheduleId;

					var clear = function() {
						if (otherInteractHandlers) {
							otherInteractHandlers.forEach(function(handle) {
								handle.remove();
							});
						}
						viewpointWatchHandle && viewpointWatchHandle.remove();
						viewStationaryHandle && viewStationaryHandle.remove();
						scheduleId && clearTimeout(scheduleId);
						otherInteractHandlers = viewpointWatchHandle =
							viewStationaryHandle = scheduleId = null;
					};

					var interactWatcher = view.watch('interacting,animation',
						function(newValue) {
							if (!newValue) {
								return;
							}
							if (viewpointWatchHandle || scheduleId) {
								return;
							}

							// start updating the other views at the next frame
							scheduleId = setTimeout(function() {
								scheduleId = null;
								viewpointWatchHandle = view.watch('viewpoint',
									function(newValue) {
										others.forEach(function(otherView) {
											otherView.viewpoint = newValue;
										});
									});
							}, 0);

							// stop as soon as another view starts interacting, like if the user starts panning
							otherInteractHandlers = others.map(function(otherView) {
								return watchUtils.watch(otherView,
									'interacting,animation',
									function(
										value) {
										if (value) {
											clear();
										}
									});
							});

							// or stop when the view is stationary again
							viewStationaryHandle = watchUtils.whenTrue(view,
								'stationary', clear);
						});

					return {
						remove: function() {
							this.remove = function() {};
							clear();
							interactWatcher.remove();
						}
					}
				};

				/**
				 * utility method that synchronizes the viewpoints of multiple views
				 */
				var synchronizeViews = function(views) {
					var handles = views.map(function(view, idx, views) {
						var others = views.concat();
						others.splice(idx, 1);
						return synchronizeView(view, others);
					});

					return {
						remove: function() {
							this.remove = function() {};
							handles.forEach(function(h) {
								h.remove();
							});
							handles = null;
						}
					}
				}

				// bind the views
				synchronizeViews([view1, view2]);

////////////垂直卷帘//////////////////////////////////////////////
				view1.on('pointer-move', function(e) {
					var x = event.screenX - 8;
					document.getElementById("view2Div").style.clip = 'rect(-11111110px,10000px,1000000px,' + x + 'px)';
				});

				view2.on('pointer-move', function(e) {
					var x = event.screenX - 8;
					document.getElementById("view2Div").style.clip = 'rect(-11111110px,10000px,1000000px,' + x + 'px)';
				});
				
////////////水平卷帘//////////////////////////////////////////////
// 				view1.on('pointer-move', function(e) {
// 					var y = event.screenY - 105;
// 					document.getElementById("view2Div").style.clip = 'rect(-10000px,10000px,' + y + 'px,-10000px)';
// 				});
// 
// 				view2.on('pointer-move', function(e) {
// 					var y = event.screenY - 105;
// 					document.getElementById("view2Div").style.clip = 'rect(-10000px,10000px,' + y + 'px,-10000px)';
// 				});
				
			});
		</script>
	</head>
	<body>

		<!-- <div id="back" style="height: 100%;width: 100%;"> -->

			<div id="view1Div" style="position:absolute;width: 100%;height: 100%;"></div>
			<div id="view2Div" style="position:absolute;width: 100%;height: 100%;"></div>





			<!-- <div id="sas" style="position:absolute;width: 50;height: 1000px;background-color: black;"></div> -->
		<!-- </div> -->


	</body>


</html>
